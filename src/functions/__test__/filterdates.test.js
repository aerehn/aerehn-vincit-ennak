import filterdates from "../filterdates";
//some example data of two granularities for the tests
//at the end there should be 4 items
const priceData1 =[
[1614816598980, 41846.94341609514],
[1614819961808, 42438.27232613161],
[1614823413623, 42762.154128398666],
[1614826904375, 42398.76198824911],
[1614830846941, 41050.43243300227],
[1614834557785, 40795.57935901453],
[1614837876365, 41288.32579618258],
[1614841510584, 40976.74119625156],
[1614845215236, 41430.446483079366],
[1614848670140, 41712.35828607881],
[1614852489056, 40750.524221581],
[1614855969051, 40986.339543453556],
[1614859715694, 41118.85008915658],
[1614863066361, 41074.879656738834],
[1614866643965, 41427.060965784534],
[1614870300639, 40725.398789528575],
[1614874071239, 41381.80158395744],
[1614877614622, 41390.90603561724],
[1614881335491, 40420.28673215821],
[1614884729237, 39800.08198170607],
[1614888184231, 40480.512374388934],
[1614892030972, 40390.557351087984],
[1614895418390, 40251.507627267056],
[1614898887234, 40502.654167283035],
[1614902656351, 40721.482241058366],
[1614906463546, 39069.3772652583],
[1614910057114, 39212.743253444685],
[1614913598474, 39687.69562116934],
[1614917096596, 39620.99620822955],
[1614920779697, 39052.099448502864],
[1614924781207, 39683.44421645894],
[1614927792119, 39787.0345590391],
[1614931323359, 39584.24819281517],
[1614935355097, 39153.4834267082],
[1614938709963, 39608.530465973825],
[1614942328994, 39666.36023137235],
[1614946288014, 40101.0426046705],
[1614949602728, 40094.44868153087],
[1614953186888, 40737.852378450654],
[1614956616811, 40441.938203253994],
[1614960482985, 40458.76459947143],
[1614963953722, 40027.38830200701],
[1614967498707, 40540.27695036309],
[1614970918078, 40812.385668447896],
[1614974933583, 41489.68672716789],
[1614978777326, 41446.51197936737],
[1614981998695, 41342.22053087084],
[1614985920206, 41255.54043698362],
[1614989231730, 41180.6560021855],
[1614992490837, 41016.46962236315],
[1614996621879, 40933.97662020028],
[1614999810997, 40921.69564963352],
[1615003721658, 40873.535946839394],
[1615007201901, 40769.658712019555],
[1615010641267, 40821.33680017061],
[1615014400610, 41138.90110234904],
[1615018059987, 41114.548862611606],
[1615021493431, 40963.64968167792],
[1615024869089, 40690.41950965817],
[1615028607032, 40449.20519265314],
[1615032902951, 40467.497429444746],
[1615035729426, 40085.40050667876],
[1615039791321, 39788.6969397025],
[1615043475347, 40074.497322623705],
[1615046691337, 40070.098322907776],
[1615050114326, 40237.50058111095],
[1615054081866, 40655.55112665722],
[1615057640223, 40826.77718446061],
[1615060915482, 40688.51220280419],
[1615064729766, 40742.4546964791],
[1615068354414, 40886.30478979944],
[1615072431822, 41213.39077782667],
[1615075853364, 41097.986129036995]
]

//At the end the number of items should be the same (96)

const priceData2 =[
    [1614729600000, 40159.69796002174],
    [1614816000000, 41970.03402467931],
    [1614902400000, 40721.482241058366],
    [1614988800000, 41197.900141066006],
    [1615075200000, 41137.103142082],
    [1615161600000, 43033.77643908508],
    [1615248000000, 44151.78354799639],
    [1615334400000, 45969.83629700157],
    [1615420800000, 46979.34120652177],
    [1615507200000, 48228.104397681615],
    [1615593600000, 47981.15078408417],
    [1615680000000, 51295.129601791945],
    [1615766400000, 49729.09033783585],
    [1615852800000, 46797.45622313987],
    [1615939200000, 47746.846623517624],
    [1616025600000, 49256.512604163196],
    [1616112000000, 48605.87962170269],
    [1616198400000, 48753.403312258655],
    [1616284800000, 48864.63909083903],
    [1616371200000, 48446.46372599024],
    [1616457600000, 45572.396859377],
    [1616544000000, 46114.717337839604],
    [1616630400000, 44461.5763385364],
    [1616716800000, 43661.54177461499],
    [1616803200000, 46661.08000365804],
    [1616889600000, 47338.79983985637],
    [1616976000000, 47277.492042457925],
    [1617062400000, 48973.897419841785],
    [1617148800000, 50043.81195360208],
    [1617235200000, 50151.45728919469],
    [1617321600000, 49928.270945521384],
    [1617408000000, 50218.97701397946],
    [1617494400000, 48523.656275506226],
    [1617580800000, 49486.91248560528],
    [1617667200000, 49682.814847849586],
    [1617753600000, 48900.66366778089],
    [1617840000000, 47281.06548137643],
    [1617926400000, 48727.12069323635],
    [1618012800000, 48864.797178312525],
    [1618099200000, 50398.64448369228],
    [1618185600000, 50399.53568851847],
    [1618272000000, 50284.5178056672],
    [1618358400000, 53178.647097858826],
    [1618444800000, 52411.35100225741],
    [1618531200000, 52786.19444052422],
    [1618617600000, 51323.24782597241],
    [1618704000000, 50303.90611604677],
    [1618790400000, 47007.348565006636],
    [1618876800000, 46274.2552812877],
    [1618963200000, 46775.796611886864],
    [1619049600000, 45015.6913673363],
    [1619136000000, 43252.75973491791],
    [1619222400000, 42311.972926691175],
    [1619308800000, 41442.08203123892],
    [1619395200000, 40507.65203218968],
    [1619481600000, 44682.359740713204],
    [1619568000000, 45484.93987625842],
    [1619654400000, 45166.2478587414],
    [1619740800000, 44204.7927866628],
    [1619827200000, 48112.22308787791],
    [1619913600000, 48097.49969239491],
    [1620000000000, 47047.72809852492],
    [1620086400000, 47437.639045229014],
    [1620172800000, 44498.3953336929],
    [1620259200000, 47831.061167924854],
    [1620345600000, 46834.930702231],
    [1620432000000, 47159.75662737094],
    [1620518400000, 48319.24375914842],
    [1620604800000, 47807.663043400964],
    [1620691200000, 46040.61343088081],
    [1620777600000, 46869.6229411901],
    [1620864000000, 41398.24254474846],
    [1620950400000, 41379.873284031484],
    [1621036800000, 41099.72887781225],
    [1621123200000, 38515.79282820282],
    [1621209600000, 38340.02021913021],
    [1621296000000, 36013.75689016597],
    [1621382400000, 35248.29953994585],
    [1621468800000, 30638.26648015515],
    [1621555200000, 33070.58223866926],
    [1621641600000, 30656.511792720983],
    [1621728000000, 30804.856177282665],
    [1621814400000, 28708.92522435034],
    [1621900800000, 31635.408235562976],
    [1621987200000, 31198.587508892317],
    [1622073600000, 32324.60180096094],
    [1622160000000, 31698.419437166936],
    [1622246400000, 29288.66616683931],
    [1622332800000, 28521.58120778627],
    [1622419200000, 29295.775354345686],
    [1622505600000, 30522.27123198109],
    [1622592000000, 30027.477592178227],
    [1622678400000, 30864.640712769786],
    [1622764800000, 32272.42993030655],
    [1622851200000, 30359.12157208613],
    [1622937600000, 29216.991986131867],
]


test("test if the granularity is processed accordingly and there is on ly one datapoint for each day",()=>{
    const data1 = filterdates(priceData1);
    const data2 = filterdates(priceData2);
    var difference1 = priceData1[priceData1.length-1][0] - priceData1[0][0];
    var difference1_in_days=Math.round(difference1/1000/60/60/24+1);
    expect(data1.length).toBe(difference1_in_days);
    expect(data2.length).toBe(priceData2.length);
})

test("test if the timestamps are from around midnigth",()=>{
    const data1 = filterdates(priceData1);
    const data2 = filterdates(priceData2);
    let data1Pass=true;
    for(let i = 0; i<data1.length;i++){
        let date = new Date(data1[i][0]);
        //if even one of the times is not from between times 00:00-00:15 then the test fails
        if(date.getUTCHours()!==0 ||  date.getUTCMinutes()>15){
            data1Pass=false;
        }
    }
    expect(data1Pass).toBe(true);
    //the granularity changes so the time should be exactly 00:00 and the filtered dates should be the same as before filtering
    let data2Pass=true;
    for(let i = 0; i<data2.length;i++){
        let date = new Date(data2[i][0]);
        if(date.getUTCHours()!==0 ||  date.getUTCMinutes()!==0){
            data2Pass=false;
        }
    }
    expect(data2Pass).toBe(true);
    expect(data2.length).toBe(priceData2.length)
})